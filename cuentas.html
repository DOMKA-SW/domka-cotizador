<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DOMKA ‚Äî Cuentas de Cobro</title>
  <link rel="icon" href="img/favicon.ico" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/app-pages.css">
  <style>
    .hidden { display: none !important; }
    .scrollable-table::-webkit-scrollbar { height: 5px; }
    .scrollable-table::-webkit-scrollbar-thumb { background: var(--green); border-radius: 3px; }
  </style>
</head>
<body>

<!-- SIDEBAR -->
<aside class="app-sidebar">
  <div class="sidebar-brand-wrap">
    <span class="sidebar-brand-name">DOMKA</span>
    <span class="sidebar-brand-sub">Construcci√≥n &amp; Dise√±o</span>
  </div>
  <nav class="sidebar-links">
    <a href="dashboard.html" class="sidebar-link"><i class="fas fa-home"></i> Dashboard</a>
    <a href="cotizaciones.html" class="sidebar-link"><i class="fas fa-file-alt"></i> Cotizaciones</a>
    <a href="cuentas.html" class="sidebar-link active"><i class="fas fa-file-invoice-dollar"></i> Cuentas de cobro</a>
    <a href="clientes.html" class="sidebar-link"><i class="fas fa-users"></i> Clientes</a>
    <a href="contabilidad.html" class="sidebar-link"><i class="fas fa-chart-bar"></i> Contabilidad</a>
  </nav>
  <div class="sidebar-bottom">
    <div class="user-indicator">
      <div class="user-dot"></div>
      <span class="user-email-text" id="user-email">Cargando‚Ä¶</span>
    </div>
    <button onclick="logout()" class="btn-logout">
      <i class="fas fa-sign-out-alt"></i> Cerrar sesi√≥n
    </button>
  </div>
</aside>

<!-- MAIN -->
<div class="page-with-sidebar">

  <div class="page-topbar">
    <div>
      <h1 class="page-heading">Cuentas de Cobro</h1>
      <p class="page-subheading">Crea y gestiona cuentas de cobro para tus clientes</p>
    </div>
    <a href="dashboard.html" class="btn-secondary px-4 py-2 rounded-lg inline-flex items-center gap-2 text-sm">
      <i class="fas fa-arrow-left"></i> Volver al Dashboard
    </a>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

    <!-- Formulario -->
    <div>
      <div class="form-container p-6 mb-6">
        <h2 class="text-xl mb-6 pb-3" style="border-bottom:1px solid var(--line)">
          Nueva Cuenta de Cobro
        </h2>

        <form id="form-cuenta" class="space-y-5">

          <div>
            <label class="form-label">Cliente</label>
            <select id="cliente" class="form-input" required>
              <option value="">‚Äî Selecciona un cliente ‚Äî</option>
            </select>
          </div>

          <!-- Notas -->
          <div>
            <label class="form-label">Notas</label>
            <div class="flex gap-2 mb-3">
              <button type="button" id="btn-notas-libre" class="px-3 py-1.5 rounded text-sm">üìù Texto libre</button>
              <button type="button" id="btn-notas-vinetas" class="px-3 py-1.5 rounded text-sm">‚Ä¢ Vi√±etas</button>
            </div>
            <div id="notas-modo-libre">
              <textarea id="notas" rows="3" spellcheck="true" lang="es" class="form-input" placeholder="Notas u observaciones..."></textarea>
            </div>
            <div id="notas-modo-vinetas" class="hidden">
              <div id="notas-vinetas-container"></div>
              <button type="button" id="agregar-vineta" class="mt-2 text-sm" style="color:var(--green)">+ Agregar vi√±eta</button>
            </div>
          </div>

          <!-- Anexos -->
          <div>
            <button type="button" id="toggle-anexos" class="w-full px-4 py-3 rounded-lg flex justify-between items-center text-sm font-semibold" style="background:var(--bg-alt);border:1px solid var(--line);color:var(--text)">
              <span><i class="fas fa-paperclip mr-2" style="color:var(--green)"></i>Anexos</span>
              <span id="icon-anexos">+</span>
            </button>
            <div id="seccion-anexos" class="hidden mt-2 p-4 rounded-lg" style="background:var(--bg-alt);border:1px solid var(--line)">
              <input type="file" id="anexos-input" multiple accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.ppt,.pptx" class="w-full rounded p-2 mb-2" style="border:1px solid var(--line)">
              <p class="text-xs" style="color:var(--gray-lt)">PDF, im√°genes, Word, PowerPoint</p>
              <ul id="lista-anexos" class="mt-3 space-y-2 text-sm"></ul>
            </div>
          </div>

          <div>
            <label class="form-label">Valor Total</label>
            <input type="number" id="valor-total" class="form-input" value="0" min="0" required>
          </div>

          <div>
            <label class="form-label">Por concepto de</label>
            <input type="text" id="concepto" class="form-input" placeholder="Ej: Servicios de construcci√≥n" required>
          </div>

          <div>
            <label class="form-label">Fecha de emisi√≥n</label>
            <input type="date" id="fecha-emision" class="form-input" required>
          </div>

          <div class="p-3 rounded-lg" style="background:var(--bg-alt);border:1px solid var(--line)">
            <label class="flex items-center gap-2" style="font-size:.88rem">
              <input type="checkbox" id="mostrar-documento" checked style="accent-color:var(--green)">
              Mostrar n√∫mero de documento en el PDF
            </label>
          </div>

          <div class="p-3 rounded-lg" style="background:var(--bg-alt);border:1px solid var(--line)">
            <label class="flex items-center gap-2" style="font-size:.88rem">
              <input type="checkbox" id="mostrar-valor-letras" checked style="accent-color:var(--green)">
              Mostrar valor total en letras en el PDF
            </label>
          </div>

          <!-- √çtems -->
          <div>
            <div class="flex justify-between items-center mb-3">
              <h3 class="font-semibold text-sm" style="color:var(--text);font-family:'DM Serif Display',serif;font-size:1rem">√çtems / Descripci√≥n del Servicio</h3>
              <button type="button" id="agregar-item" class="btn-primary px-3 py-2 rounded-lg text-sm">
                + Agregar √çtem
              </button>
            </div>
            <div id="items-container" class="space-y-3"></div>
          </div>

          <button type="submit" class="btn-primary px-6 py-3 rounded-lg text-base w-full">
            Guardar Cuenta de Cobro
          </button>
        </form>
      </div>
    </div>

    <!-- Lista -->
    <div>
      <div class="form-container p-5">
        <div class="flex items-center justify-between mb-5 pb-3" style="border-bottom:1px solid var(--line)">
          <h2 class="text-xl">Cuentas Guardadas</h2>
          <div class="flex gap-2">
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold" style="background:#fef3c7;color:#92400e">pendiente</span>
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold" style="background:#d1fae5;color:#065f46">pagada</span>
          </div>
        </div>
        <div class="scrollable-table">
          <table class="w-full border-collapse" id="tabla-cuentas">
            <thead>
              <tr>
                <th class="p-3 text-left">Cliente</th>
                <th class="p-3 text-right">Total</th>
                <th class="p-3 text-center">Estado</th>
                <th class="p-3 text-left">Fecha</th>
                <th class="p-3 text-left">Acciones</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
<script src="js/firebase.js"></script>
<script src="js/auth.js"></script>
<script src="js/numero-letras.js"></script>
<script src="js/pdf-cuenta.js"></script>
<script src="js/cuentas.js"></script>
<script>
  if (typeof auth !== 'undefined' && auth.onAuthStateChanged) {
    auth.onAuthStateChanged(u => {
      const el = document.getElementById('user-email');
      if (el) el.textContent = u?.email || 'Usuario';
    });
  }
  function logout() {
    if (typeof auth !== 'undefined') auth.signOut().then(() => window.location.href = 'index.html');
  }
</script>
</body>
</html>
