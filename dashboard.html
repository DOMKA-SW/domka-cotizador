<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DOMKA — Dashboard</title>
  <link rel="icon" href="img/favicon.ico" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/domka-design.css">
  <style>
    /* ── WELCOME BANNER ── */
    .welcome-banner {
      background: var(--green);
      border-radius: 14px;
      padding: 28px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 32px;
      overflow: hidden;
      position: relative;
    }

    .welcome-banner::before {
      content: '';
      position: absolute;
      top: -40px; right: -40px;
      width: 180px; height: 180px;
      background: rgba(255,255,255,.07);
      border-radius: 50%;
    }

    .welcome-banner::after {
      content: '';
      position: absolute;
      bottom: -50px; right: 80px;
      width: 140px; height: 140px;
      background: rgba(255,255,255,.05);
      border-radius: 50%;
    }

    .welcome-text h2 {
      font-family: 'DM Serif Display', serif;
      font-size: 1.6rem; color: #fff; margin-bottom: 4px;
    }

    .welcome-text p { color: rgba(255,255,255,.75); font-size: .9rem; }

    .welcome-badge {
      background: rgba(255,255,255,.15);
      border: 1px solid rgba(255,255,255,.25);
      border-radius: 8px;
      padding: 8px 18px;
      color: #fff; font-size: .82rem; font-weight: 600;
      backdrop-filter: blur(4px);
    }

    /* ── ACTIVITY FEED ── */
    .activity-item {
      display: flex;
      align-items: flex-start;
      gap: 14px;
      padding: 14px 0;
      border-bottom: 1px solid var(--line-lt);
    }
    .activity-item:last-child { border-bottom: none; }

    .activity-dot {
      width: 8px; height: 8px;
      background: var(--green); border-radius: 50%;
      flex-shrink: 0; margin-top: 6px;
    }

    .activity-text { font-size: .88rem; color: var(--text); }
    .activity-time { font-size: .75rem; color: var(--gray-lt); margin-top: 2px; }

    /* ── QUICK ACTIONS ── */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px,1fr));
      gap: 14px;
    }

    .quick-action {
      background: var(--bg-white);
      border: 1px solid var(--line);
      border-radius: var(--radius-lg);
      padding: 22px 20px;
      text-align: center;
      transition: var(--t);
      cursor: pointer;
      display: block;
    }

    .quick-action:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-3px);
      border-color: var(--green);
    }

    .qa-icon {
      width: 48px; height: 48px;
      background: var(--green-lt); border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      color: var(--green); font-size: 1.2rem;
      margin: 0 auto 14px;
    }

    .qa-name {
      font-weight: 600; font-size: .9rem; color: var(--text); margin-bottom: 4px;
    }

    .qa-desc { font-size: .75rem; color: var(--gray-lt); }
  </style>
</head>
<body>
<div class="app-layout">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-brand">
      <div><img src="img/logo.png" alt="DOMKA" style="height:28px;margin-bottom:8px" onerror="this.style.display='none'"></div>
      <h2>DOMKA</h2>
      <span>Panel de control</span>
    </div>

    <nav class="sidebar-nav">
      <a href="dashboard.html" class="nav-item active">
        <i class="fas fa-home"></i> Dashboard
      </a>
      <a href="cotizaciones.html" class="nav-item">
        <i class="fas fa-file-alt"></i> Cotizaciones
      </a>
      <a href="cuentas.html" class="nav-item">
        <i class="fas fa-file-invoice-dollar"></i> Cuentas de cobro
      </a>
      <a href="clientes.html" class="nav-item">
        <i class="fas fa-users"></i> Clientes
      </a>
      <a href="contabilidad.html" class="nav-item">
        <i class="fas fa-chart-bar"></i> Contabilidad
      </a>
    </nav>

    <div class="sidebar-footer">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:14px">
        <div style="width:8px;height:8px;background:#22c55e;border-radius:50%"></div>
        <span style="font-size:.8rem;color:var(--gray)" id="user-email">Cargando…</span>
      </div>
      <button onclick="logout()" class="btn btn-outline btn-sm" style="width:100%;justify-content:center">
        <i class="fas fa-sign-out-alt"></i> Cerrar sesión
      </button>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main-content">

    <!-- TOP BAR -->
    <div class="top-bar">
      <div class="page-title">
        <h1>Dashboard</h1>
        <p>Resumen de actividad · DOMKA</p>
      </div>
      <div style="display:flex;gap:10px">
        <a href="cotizaciones.html" class="btn btn-green">
          <i class="fas fa-plus"></i> Nueva cotización
        </a>
      </div>
    </div>

    <!-- WELCOME BANNER -->
    <div class="welcome-banner">
      <div class="welcome-text">
        <h2>Bienvenido a DOMKA</h2>
        <p>Tu plataforma de cotizaciones profesionales · Construcción &amp; Diseño</p>
      </div>
      <div class="welcome-badge">
        <i class="fas fa-circle" style="font-size:.5rem;margin-right:6px;color:#4ade80"></i>
        Sistema activo
      </div>
    </div>

    <!-- STATS -->
    <div class="stat-cards">
      <div class="stat-card">
        <div class="stat-label">Cotizaciones</div>
        <div class="stat-value" id="count-cot">—</div>
        <div class="stat-sub">Total registradas</div>
      </div>
      <div class="stat-card" style="position:relative">
        <div class="stat-label">Cuentas de cobro</div>
        <div class="stat-value" id="count-cuentas">—</div>
        <div class="stat-sub">Total generadas</div>
        <span id="badge-pendientes" style="display:none;position:absolute;top:14px;right:14px;background:var(--green);color:#fff;border-radius:999px;padding:2px 9px;font-size:.68rem;font-weight:700"></span>
      </div>
      <div class="stat-card">
        <div class="stat-label">Ingresos cobrados</div>
        <div class="stat-value" id="sum-pagadas" style="font-size:1.4rem">—</div>
        <div class="stat-sub">Cuentas pagadas</div>
      </div>
    </div>

    <!-- GRID: MÓDULOS + ACTIVIDAD -->
    <div style="display:grid;grid-template-columns:1fr 320px;gap:24px;margin-bottom:32px">

      <!-- Módulos rápidos -->
      <div>
        <p style="font-size:.65rem;font-weight:700;letter-spacing:.2em;text-transform:uppercase;color:var(--green);margin-bottom:16px">Accesos rápidos</p>
        <div class="quick-actions">
          <a href="cotizaciones.html" class="quick-action">
            <div class="qa-icon"><i class="fas fa-file-alt"></i></div>
            <div class="qa-name">Cotizaciones</div>
            <div class="qa-desc">Crear y gestionar</div>
          </a>
          <a href="cuentas.html" class="quick-action">
            <div class="qa-icon"><i class="fas fa-file-invoice-dollar"></i></div>
            <div class="qa-name">Cuentas de cobro</div>
            <div class="qa-desc">Crear y gestionar</div>
          </a>
          <a href="clientes.html" class="quick-action">
            <div class="qa-icon"><i class="fas fa-users"></i></div>
            <div class="qa-name">Clientes</div>
            <div class="qa-desc">Administrar directorio</div>
          </a>
          <a href="contabilidad.html" class="quick-action">
            <div class="qa-icon"><i class="fas fa-chart-bar"></i></div>
            <div class="qa-name">Contabilidad</div>
            <div class="qa-desc">Reportes y finanzas</div>
          </a>
        </div>
      </div>

      <!-- Actividad reciente -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Actividad reciente</span>
        </div>
        <div class="card-pad" style="padding-top:8px">
          <div class="activity-item">
            <div class="activity-dot"></div>
            <div>
              <div class="activity-text">Sistema listo y operativo</div>
              <div class="activity-time">Ahora</div>
            </div>
          </div>
          <div class="activity-item">
            <div class="activity-dot" style="background:var(--gray-lt)"></div>
            <div>
              <div class="activity-text">Inicia sesión para ver actividad</div>
              <div class="activity-time">—</div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Footer -->
    <div style="border-top:1px solid var(--line);padding-top:24px;text-align:center;font-size:.78rem;color:var(--gray-lt)">
      DOMKA Construcción &amp; Diseño ·
      <a href="mailto:piter030509@gmail.com" style="color:var(--green)">piter030509@gmail.com</a> ·
      +57 305 811 4595 · © 2026
    </div>

  </main>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="js/firebase.js"></script>
<script src="js/auth.js"></script>

<script>
  auth.onAuthStateChanged(user => {
    document.getElementById("user-email").textContent = user?.email || "Usuario";
  });

  function logout() {
    auth.signOut().then(() => { window.location.href = "index.html"; });
  }

  (async function () {
    try {
      const cotSnap = await db.collection("cotizaciones").get();
      const cuentasSnap = await db.collection("cuentas").get();

      document.getElementById("count-cot").textContent = cotSnap.size.toLocaleString("es-CO");
      document.getElementById("count-cuentas").textContent = cuentasSnap.size.toLocaleString("es-CO");

      let sumaPagadas = 0, pendientes = 0;
      cuentasSnap.forEach(d => {
        const data = d.data();
        if (data.estado === "pagada") sumaPagadas += Number(data.total || 0);
        if (data.estado === "pendiente" || !data.estado) pendientes++;
      });

      document.getElementById("sum-pagadas").textContent = `$${sumaPagadas.toLocaleString("es-CO")}`;

      if (pendientes > 0) {
        const badge = document.getElementById("badge-pendientes");
        badge.style.display = "inline-block";
        badge.textContent = `${pendientes} pend.`;
      }
    } catch (e) {
      console.error(e);
    }
  })();
</script>
</body>
</html>
